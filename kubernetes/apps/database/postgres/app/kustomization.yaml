---
# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ./users
  - ./externalsecret.yaml
  - ./helmrelease.yaml
  - ./user-template.yaml
  - ./ingress.yaml
configMapGenerator:
- name: ${APP}-values
  files:
  - values.yaml=./resources/values.yaml
  options:
    disableNameSuffixHash: true
patches:
  - target:
      kind: Service
      version: v1
      name: ${APP}-rw
    patch: |-
      apiVersion: v1
      kind: Service
      metadata:
        name: not-used
        annotations:
          tailscale.com/expose: "true"
          tailscale.com/hostname: ${APP}-${CLUSTER_CNAME}
