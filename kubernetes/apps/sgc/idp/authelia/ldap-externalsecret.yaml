---
# yaml-language-server: $schema=https://raw.githubusercontent.com/datreeio/CRDs-catalog/main/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: authelia-ldap
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    template:
      data:
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_ADDRESS: "ldap://lldap.sgc.svc.cluster.local:3890"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_IMPLEMENTATION: "custom"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_TIMEOUT: "5s"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_START_TLS: "false"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_BASE_DN: "{{ .base_dn }}"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_ADDITIONAL_USERS_DN: "ou=people"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_USERS_FILTER: "(&({username_attribute}={input})(objectClass=person))"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_ADDITIONAL_GROUPS_DN: "ou=groups"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_GROUPS_FILTER: "(&(member={dn})(objectClass=groupOfUniqueNames))"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_USER: "uid=admin,ou=people,{{ .base_dn }}"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_PASSWORD: "{{ .password }}"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_ATTRIBUTES_USERNAME: "uid"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_ATTRIBUTES_DISPLAY_NAME: "displayName"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_ATTRIBUTES_GROUP_NAME: "cn"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_ATTRIBUTES_MAIL: "mail"
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_ATTRIBUTES_MEMBER_OF: "memberOf"
  dataFrom:
    - extract:
        key: LLDAP Database
